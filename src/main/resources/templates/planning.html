<div id="journey-container">
    <div id="journey-status">
        <div class="working">
            <h3>Planning your journey...</h3>
            <p>Process <code th:text="${processId}"></code></p>
            <div class="process-controls">
                <a th:href="@{/api/v1/process/{id}(id=${processId})}"
                   target="_blank"
                   class="btn btn-primary">
                    Open Process
                </a>
                <button type="button"
                        th:hx-delete="@{/api/v1/process/{id}(id=${processId})}"
                        hx-confirm="Are you sure you want to kill this process?"
                        hx-target="this"
                        hx-swap="outerHTML"
                        class="scary-delete-btn">
                    Kill Process
                </button>
            </div>
            <div class="spinner"></div>
        </div>

    <div id="sse-updates">
        <p>Initializing...</p>
    </div>
</div>

<script>
    const processId = '[[${processId}]]';
    const eventSource = new EventSource(`/events/process/${processId}`);

    eventSource.addEventListener('agent-process-event', function (event) {
        const data = JSON.parse(event.data);

        // Handle completion events
        switch (data.type) {
            case "GoalAchievedEvent":
                eventSource.close();
                window.location.href = `/travel/journey/status/${processId}`;
                return;

        }

        const target = document.getElementById('sse-updates');
        if (target) {
            let userMessage;
            let actionMessage = "Finding points of interest...";
            let everyEvent = data.type;

            switch (data.type) {
                case 'ActionExecutionStartEvent':
                    actionMessage = `ðŸš€ Executing ${data.action?.name.replace('_', ' ')}`;
                    break;
                case 'ToolCallRequestEvent':
                    userMessage = `ðŸ”§ Connecting to ${data.tool}`;
                    break;
                case 'ChatModelCallEvent':
                    userMessage = `ðŸ¤– Processing with ${data.llm?.name}`;
                    break;
                default:
                    userMessage = `âš¡ Processing ${data.type.replace('Event', '')}`;
            }


            target.innerHTML = `
                <div class="process-update">
                    <div class="message">${actionMessage}</div>
                    <div class="message">${userMessage}</div>
                     <div class="message">${everyEvent}</div>
                </div>
            `;
        }
    });
</script>